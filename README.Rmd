---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

# `provider` <img src="man/figures/logo.svg" align="right" height="200" />

<!-- badges: start -->
[![R-CMD-check](https://github.com/andrewallenbruce/provider/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/andrewallenbruce/provider/actions/workflows/R-CMD-check.yaml)
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Project Status: WIP - Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg)](https://choosealicense.com/licenses/mit/)
[![code size](https://img.shields.io/github/languages/code-size/andrewallenbruce/provider.svg)](https://github.com/andrewallenbruce/provider)
[![last commit](https://img.shields.io/github/last-commit/andrewallenbruce/provider.svg)](https://github.com/andrewallenbruce/provider/commits/main)
[![Codecov test coverage](https://codecov.io/gh/andrewallenbruce/provider/branch/main/graph/badge.svg)](https://app.codecov.io/gh/andrewallenbruce/provider?branch=main)
[![CodeFactor](https://www.codefactor.io/repository/github/andrewallenbruce/provider/badge)](https://www.codefactor.io/repository/github/andrewallenbruce/provider)
<!-- badges: end -->

> Providing easy access to [healthcare provider](https://en.wikipedia.org/wiki/Health_care_provider)-centric data through publicly available APIs & sources.
 

<br>

## Installation

You can install the development version of `provider` from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("andrewallenbruce/provider")
```
``` r
# install.packages("remotes")
remotes::install_github("andrewallenbruce/provider")
```

```{r results='asis', echo=FALSE}
provider:::function_tbl()
```

<br>

## Motivation

```{r echo=TRUE}
# Load library
library(provider)
```

<br>

This package is primarily focused on accessing public API data that can be linked together via a healthcare provider's National Provider Identifier (NPI). Thus far, none of the APIs require the creation of a user account or API key. The data tend to fall into (and sometimes between) one of two categories: informational/operational and analytical. It only gets interesting when you start to link them together.

<br>

## Informational APIs

### NPPES NPI Registry

```{r}
npi_1 <- provider::nppes_npi(npi = 1710975040)
npi_1 |> dplyr::glimpse()
```
<br>

```{r results='asis', echo=TRUE}
npi_1 |> dplyr::select(datetime:state) |> gluedown::md_table()
```
<br>

   * Basic Information

```{r results='asis', echo=TRUE}
npi_1 |> 
  dplyr::select(basic) |> 
  tidyr::unnest(basic) |> 
  tidyr::pivot_longer(dplyr::everything()) |> 
  gluedown::md_table()
```
<br>

   * Taxonomies

```{r results='asis', echo=TRUE}
npi_1 |> 
  dplyr::select(taxonomies) |> 
  tidyr::unnest(taxonomies) |> 
  gluedown::md_table()
```

<br>

   * Addresses

```{r results='asis', echo=TRUE}
npi_1 |> 
  dplyr::select(addresses) |> 
  tidyr::unnest(addresses) |> 
  tidyr::pivot_longer(!address_purpose) |> 
  tidyr::pivot_wider(names_from = address_purpose, 
                     values_from = value) |> 
  gluedown::md_table()
```

<br>

   * Identifiers

```{r results='asis', echo=TRUE}
npi_1 |> 
  dplyr::select(identifiers) |> 
  tidyr::unnest(identifiers) |> 
  gluedown::md_table()
```

<br><br>

### CMS Physician Facility Affiliations

```{r results='asis', echo=TRUE}
provider::facility_affiliations(npi = 1003019563) |> 
  dplyr::select(-record_number, -suff, -parent_ccn) |> 
  gluedown::md_table()
```
<br><br>

```{r results='asis', echo=TRUE}
provider::facility_affiliations(facility_ccn = "060004") |> 
  dplyr::select(-record_number, -suff, -parent_ccn) |> 
  head(n = 25) |> 
  gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
provider::facility_affiliations(parent_ccn = 670055) |> 
  dplyr::select(-record_number, -suff, -parent_ccn) |> 
  gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
provider::facility_affiliations(first_name = "John", 
                                last_name = "Hill", 
                                facility_type = "Home Health Agency") |> 
  dplyr::select(-record_number) |> 
  gluedown::md_table()
```


<br><br>

### CMS Doctors and Clinicians National File

```{r results='asis', echo=TRUE}
# search by npi
doctors_and_clinicians(npi = 1407263999) |> 
  dplyr::mutate(dplyr::across(everything(), as.character)) |>
  tidyr::pivot_longer(cols = dplyr::everything()) |> 
  gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
# search by medical school
doctors_and_clinicians(med_sch = "NEW YORK UNIVERSITY SCHOOL OF MEDICINE", 
                       grad_year = 2003, 
                       state = "FL") |> 
  dplyr::mutate(dplyr::across(everything(), as.character)) |>
  tidyr::pivot_longer(cols = dplyr::everything()) |> 
  gluedown::md_table()
```


<br><br>


### CMS Missing Contact Information

```{r results='asis', echo=TRUE}
provider::missing_information(npi = 1144224569) |> gluedown::md_table()
```

<br><br>

### Medicare Order and Referring

```{r results='asis', echo=TRUE}
provider::order_refer(npi = 1083879860) |> gluedown::md_table()
```

<br><br>

### Medicare Opt-Out Affidavits

```{r results='asis', echo=TRUE}
provider::opt_out(last = "Aaron") |> 
  dplyr::mutate(dplyr::across(everything(), as.character)) |>
  tidyr::pivot_longer(cols = dplyr::everything()) |> 
  gluedown::md_table()
```

<br><br>

### Medicare Provider and Supplier Taxonomy Crosswalk

```{r results='asis', echo=TRUE}
provider::taxonomy_crosswalk(specialty_desc = "Rehabilitation Agency") |> 
  dplyr::select(medicare_specialty_code, 
                medicare_specialty_description = medicare_provider_supplier_type_description,
                provider_taxonomy_code,
                provider_taxonomy_description = provider_taxonomy_description_type_classification_specialization) |> 
  gluedown::md_table()
```

<br><br>

### Medicare Fee-For-Service Public Provider Enrollment

```{r}
prven <- tibble::tribble(
~fn,         ~params,
"provider_enrollment", list(npi = 1083879860),
"provider_enrollment", list(first_name = "MICHAEL", middle_name = "K", last_name = "GREENBERG", state = "MD"),
"provider_enrollment", list(org_name = "LUMINUS DIAGNOSTICS LLC", state = "GA"),
)

purrr::invoke_map_dfr(prven$fn, prven$params)
```

<br><br>

### Medicare Pending Initial Logging and Tracking

<br>

```{r results='asis', echo=TRUE}
provider::pending_applications(npi = 1487003984, type = "physician") |> 
  gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
provider::pending_applications(npi = 1487003984, type = "non-physician") |> 
  gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
provider::pending_applications(last_name = "Abbott", type = "non-physician") |> 
  gluedown::md_table()
```
<br><br>

```{r results='asis', echo=TRUE}
pending_applications(first_name = "John", type = "physician") |> 
  gluedown::md_table()
```


<br><br>


### Medicare Revalidation APIs

Medicare Revalidation Due Date API

```{r results='asis', echo=TRUE}
date <- provider::revalidation_date(npi = 1710912209)
date |> 
  dplyr::mutate(dplyr::across(everything(), as.character)) |>
  tidyr::pivot_longer(cols = dplyr::everything()) |> 
  gluedown::md_table()
```

<br><br>

Medicare Revalidation Reassignment List API

```{r results='asis', echo=TRUE}
list <- provider::revalidation_reassign(ind_npi = 1710912209)

list |> dplyr::mutate(dplyr::across(everything(), as.character)) |>
        tidyr::pivot_longer(cols = dplyr::everything()) |> 
        gluedown::md_table()
```

<br><br>

Medicare Revalidation Clinic Group Practice Reassignment API

```{r results='asis', echo=TRUE}
group <- provider::revalidation_group(ind_npi = 1710912209)

group |> dplyr::mutate(dplyr::across(everything(), as.character)) |>
         tidyr::pivot_longer(cols = dplyr::everything()) |> 
         gluedown::md_table()
```

<br><br>

## Analytical APIs

### CMS Open Payments API

```{r}
op <- open_payments(recipient_npi = 1043218118)
```

<br>

```{r results='asis', echo=TRUE}
op |> tidyr::hoist(covered_recipient, 
                   recipient_npi = "covered_recipient_npi",
                   profile_id = "covered_recipient_profile_id",
                   first_name = "covered_recipient_first_name", 
                   last_name = "covered_recipient_last_name",
                   credential = "covered_recipient_primary_type_1",) |> 
      tidyr::hoist(recipient_address, 
                   city = "recipient_city", 
                   state = "recipient_state") |> 
      dplyr::select(program_year, 
                    recipient_npi, 
                    profile_id,
                    first_name,
                    last_name,
                    credential,
                    city,
                    state) |> 
      dplyr::slice_head() |> 
      gluedown::md_table()
```

<br>

```{r results='asis', echo=TRUE}
op_2 <- op |> tidyr::hoist(applicable_mfg_gpo, 
                           manufacturer_gpo_paying = "applicable_manufacturer_or_applicable_gpo_making_payment_name") |>
             tidyr::hoist(associated_drug_device, 
                          type = "indicate_drug_or_biological_or_device_or_medical_supply_1",
                          therapeutic_category = "product_category_or_therapeutic_area_1",
                          name = "name_of_drug_or_biological_or_device_or_medical_supply_1") |> 
             dplyr::select(payment_date = date_of_payment, 
                          manufacturer_gpo_paying,
                          type, 
                          name,
                          therapeutic_category,
                          payment_total = total_amount_of_payment_usdollars,
                          nature_of_payment = nature_of_payment_or_transfer_of_value) |> 
             dplyr::arrange(payment_date)

op_2 |> dplyr::mutate(nature_of_payment = stringr::str_trunc(nature_of_payment, 20, "right"),
                      manufacturer_gpo_paying = stringr::str_trunc(manufacturer_gpo_paying, 20, "right"),
                      name = stringr::str_trunc(name, 20, "right"),
                      therapeutic_category = stringr::str_trunc(therapeutic_category, 20, "right")) |> gluedown::md_table()
```

<br>

```{r results='asis', echo=TRUE}
op_2 |> 
  dplyr::group_by(manufacturer_gpo_paying, nature_of_payment, name) |> 
  dplyr::summarise(n = dplyr::n(),
                   payment_total = sum(payment_total), .groups = "drop") |> 
  dplyr::mutate(nature_of_payment = stringr::str_trunc(nature_of_payment, 20, "right")) |> 
  dplyr::arrange(dplyr::desc(payment_total)) |> 
  gluedown::md_table()
```

<br><br>

### Medicare Monthly Enrollment API

```{r}
months <- tibble::enframe(month.name) |> 
  dplyr::select(-name) |> 
  dplyr::slice(1:7) |> 
  tibble::deframe()

purrr::map_dfr(months, ~beneficiary_enrollment(year = 2022, geo_level = "State", state = "Georgia", month = .x))
```


<br><br>

### Medicare Physician & Other Practitioners APIs

<br>

> 1. by Provider and Service API:

<br>

```{r}
(pbs <- purrr::map_dfr(2013:2020, ~physician_by_service(npi = 1003000126, year = .x)))
```

<br>

> 2. by Geography and Service API:

<br>

```{r results='asis', echo=TRUE}
srvcs <- provider::physician_by_service(npi = 1003000126, year = 2020) |> 
         tidyr::unnest(cols = c(rndrng_prvdr, totals_srvcs, hcpcs, averages))

srvcs |> dplyr::select(year, 
                       tot_benes:tot_srvcs, 
                       hcpcs_cd, 
                       avg_sbmtd_chrg:avg_mdcr_pymt_amt) |> 
         gluedown::md_table()
```

<br>
<br>

```{r results='asis', echo=TRUE}
nat <- purrr::map_dfr(srvcs$hcpcs_cd, ~physician_by_geography(geo_level = "National", year = 2020, hcpcs_code = .x))

nat |> dplyr::filter(place_of_srvc == "F") |>  
       dplyr::select(year, 
                     tot_rndrng_prvdrs:tot_srvcs, 
                     hcpcs_cd, 
                     avg_sbmtd_chrg:avg_mdcr_pymt_amt) |> 
       gluedown::md_table()
```

<br>
<br>

```{r results='asis', echo=TRUE}
state <- purrr::map_dfr(srvcs$hcpcs_cd, ~physician_by_geography(geo_desc = "Maryland", year = 2020, hcpcs_code = .x))

state |> dplyr::filter(place_of_srvc == "F") |>  
         dplyr::select(year, 
                       tot_rndrng_prvdrs:tot_srvcs, 
                       hcpcs_cd, 
                       avg_sbmtd_chrg:avg_mdcr_pymt_amt) |> 
         gluedown::md_table()
```

<br>
<br>

> 3. by Provider API:

<br><br>

```{r, echo=TRUE}
(prov <- purrr::map_dfr(as.character(2013:2020), ~physician_by_provider(npi = 1003000126, year = .x)))
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(rndrng_npi, rndrng_prvdr) |> 
        tidyr::unnest(cols = c(rndrng_prvdr)) |> 
        dplyr::slice_head() |> 
        tidyr::pivot_longer(cols = dplyr::everything()) |> 
        gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(year, totals_srvcs) |> 
        tidyr::unnest(cols = c(totals_srvcs)) |> 
        gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(year, bene_age) |> 
        tidyr::unnest(cols = c(bene_age)) |> 
        gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(year, bene_sex, bene_status) |> 
        tidyr::unnest(cols = c(bene_sex, bene_status)) |> 
        gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(year, bene_race) |> 
        tidyr::unnest(cols = c(bene_race)) |> 
        gluedown::md_table()
```

<br><br>

```{r results='asis', echo=TRUE}
prov |> dplyr::select(year, bene_cc) |> 
     tidyr::unnest(cols = c(bene_cc)) |> 
     gluedown::md_table()
```

<br><br>

### Medicare Chronic Conditions APIs

<br>

 > Medicare Multiple Chronic Conditions API

<br>

```{r results='asis', echo=TRUE}
mult <- cc_multiple(year = 2007, geo_lvl = "National", demo_lvl = "Race")

mult |> dplyr::select(year, bene_age_lvl, bene_demo_desc:er_visits_per_1000_benes) |> 
        gluedown::md_table()
```

<br><br>

 > Medicare Specific Chronic Conditions API

<br>

```{r results='asis', echo=TRUE}
spec <- cc_specific(year = 2007, geo_lvl = "National", demo_lvl = "Race")

spec |> dplyr::select(year, bene_age_lvl, bene_demo_desc:prvlnc) |> 
        gluedown::md_table()
```

<br><br>

------------------------------------------------------------------------------

## Code of Conduct

Please note that the provider project is released with a [Contributor Code of Conduct](https://andrewallenbruce.github.io/provider/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
