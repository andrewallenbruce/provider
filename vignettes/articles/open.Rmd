---
title: "Open Payments"
subtitle: "Financial Relationships"
author: "Andrew Bruce"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 600, 
  out.width = "100%"
)
options(scipen = 999)
```

```{r message=FALSE, warning=FALSE}
library(provider)
library(future)
library(furrr)
library(dplyr)
```

```{r}
open_payments(year = 2021, npi = 1043218118, na.rm = TRUE)
```



```{r}
plan(multisession, workers = 4)
open  <- open_payments_(npi = 1043218118)
plan(sequential)
open
```


```{r}
open |> 
  select(program_year, 
         payer_name, 
         pay_form,
         pay_nature,
         pay_total, 
         pay_date, 
         pay_count, 
         row_id, 
         group_id, 
         name, 
         covered,
         type, 
         category, 
         ndc,
         pdi)
```


```{r}
open |> 
  count(payer_sub,
        wt = pay_count,
        sort = TRUE)
```


```{r}
open |> 
  count(payer_name,
        wt = pay_count,
        sort = TRUE)
```


```{r}
open |> 
  count(payer_id,
        wt = pay_count,
        sort = TRUE)
```


```{r}
open |> 
  filter(!is.na(type)) |> 
  count(type, sort = TRUE)
```



