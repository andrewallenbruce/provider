---
title: "Quality Payment Program"
subtitle: "Demographics, Patient Mix, and Performance"
author: "Andrew Bruce"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 600, 
  out.width = "100%"
)
options(scipen = 999)
```

```{r message=FALSE, warning=FALSE}
library(provider)
library(future)
library(furrr)
library(dplyr)
library(tidyr)
```

```{r}
nppes(npi = 1144544834) |> 
  glimpse()
```

<br>

```{r}
plan(multisession, workers = 4)
q <- quality_payment_(npi = 1144544834)
plan(sequential)
q
```


## Special Statuses

```{r}
select(q, year, statuses) |> 
  unnest(statuses)
```

<br>

```{r}
select(q, year, statuses) |> 
  unnest(statuses) |> 
  count(category, sort = TRUE)
```

<br>

## Individual Category Measures

```{r}
select(q, year, measures) |> 
  unnest(measures)
```


<br>

```{r}
select(q, year, measures) |> 
  unnest(measures) |> 
  count(measure, sort = TRUE)
```

<br>

## Quality Eligibility

```{r}
s <- 2017:2023 |>
  purrr::map(\(x) quality_eligibility(year = x, npi = 1043477615)) |>
  purrr::list_rbind()

s |> dplyr::select(year:org_virtual_groups) |> dplyr::glimpse()
```



```{r}
s |> dplyr::select(year, dplyr::starts_with("ind.")) |> dplyr::glimpse()
```


```{r}
s |> dplyr::select(year, dplyr::starts_with("org_apms.")) |> dplyr::glimpse()
```


```{r}
s |> dplyr::select(year, dplyr::starts_with("grp.")) |> dplyr::glimpse()
```


<br><br>

```{r}
t <- 2017:2023 |>
  purrr::map(\(x) quality_eligibility(year = x, npi = 1144544834)) |>
  purrr::list_rbind()

t |> dplyr::select(year:org_virtual_groups) |> dplyr::glimpse()
```


```{r}
t |> dplyr::select(year, dplyr::starts_with("ind.")) |> dplyr::glimpse()
```

```{r}
t |> 
  dplyr::select(year, dplyr::starts_with("org_apms.")) |> 
  dplyr::glimpse()
```


```{r}
t |> dplyr::select(year, dplyr::starts_with("grp.")) |> dplyr::glimpse()
```

