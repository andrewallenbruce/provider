---
title: "Medicare Order and Referring API"
output: html_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

```{r}
library(provider)
```

<br>

> *Providers That are Legally Eligible to Order and Refer in the Medicare Program and Have Current Enrollment Records in Medicare.*

<br>


The Order and Referring dataset provides information on all physicians and non-physician practitioners, by their National Provider Identifier (NPI), who are of a type/specialty that is legally eligible to order and refer in the Medicare program and who have current enrollment records in Medicare. This dataset is based on information gathered from the Provider Enrollment, Chain and Ownership System (PECOS).

Ordering providers can order non-physician services for patients. Referring providers can request items or services which Medicare may reimburse on behalf of Medicare beneficiaries. To qualify as an ordering and certifying/referring provider, a provider must have an individual National Provider Identifier (NPI), be enrolled in Medicare in either an “approved” or an “opt-out” status, and be of an eligible specialty type. Providers currently enrolled as a Medicare Part B provider can already order and certifyand do not need to re-enroll in Medicare.

In the event a provider does not want to bill Medicare for their services, they can still order and refer/certify by opting out of Medicare or enrolling solely to order and certify. Medicare coverage will then apply when ordering or certifying:

   - Durable Medical Equipment, Prosthetics, Orthotics, and Supplies (DMEPOS)
   - Clinical Laboratory Services
   - Imaging Services
   - Home Health Services

<br>

## Example Searchs

```{r}
order_refer(npi = 1083879860)
```
<br>

```{r}
order_refer(last_name = "Smith", 
            partb = FALSE, 
            pmd = FALSE)
```

<br>

## Visualizations

<details><summary>Code for table</summary>

```{r}
gt_oref <- order_refer(last_name = "Smith", first_name = "Aaron") |> 
  gt::gt() |> 
  gtExtras::gt_theme_538() |> 
  gt::tab_style(
    style = gt::cell_text(font = c(
      gt::google_font(name = "Fira Code"), 
      gt::default_fonts())),
    locations = gt::cells_body(columns = c(npi))) |> 
  gt::text_case_when(
    x == TRUE ~ gt::html(fontawesome::fa("circle-check", 
                               prefer_type = "solid", 
                               fill = "black", 
                               height = "1.75em", 
                               width = "1.75em")),
    x == FALSE ~ gt::html(fontawesome::fa("circle-xmark", 
                                   prefer_type = "solid", 
                                   fill = "red", 
                               height = "1.75em", 
                               width = "1.75em")),
    .default = "", .locations = gt::cells_body(
      columns = c(partb, dme, hha, pmd))) |> 
  gt::cols_label(first_name = "First Name", 
                 last_name = "Last Name",
                 partb = "Part B", 
                 dme = "DME", 
                 hha = "HHA", 
                 pmd = "PMD") |> 
  gtExtras::gt_add_divider(columns = c("last_name"), 
                           style = "solid",
                           color = "black",
                           weight = gt::px(3),
                           include_labels = FALSE) |> 
  gt::tab_header(title = gt::md("Medicare Order & Referring Eligibility"),
    subtitle = gt::md("Provider Eligibility to Refer Patients to **Medicare Part B**, **Home Health Agencies**, **Durable Medical Equipment Suppliers**, and **Powered Mobility Devices**")) |> 
  gt::tab_source_note(source_note = "Source: data.cms.gov") |> 
  gt::opt_table_font(font = gt::google_font(name = "Karla"))
```

</details>

```{r}
gt_oref
```


<br>

### Data Dictionary

```{r echo=FALSE}
tibble::tibble(
  Variable = c(
    "`npi`", "`last_name`", "`first_name`", "`partb`", "`dme`",
    "`hha`", "`pmd`"
  ),
  Description = c("NPI", "Last Name", "First Name", "Part B", "DME", "HHA", "PMD"),
  Definition = c(
    "National Provider Identifier (NPI) of the Order and Referring Provider",
    "Last Name of the Order and Referring Provider", 
    "First Name of the Order and Referring Provider",
    "Indicates if Provider can refer to Medicare Part B", 
    "Indicates if Provider can order Durable Medical Equipment (DME)",
    "Indicates if Provider can refer to a Home Health Agency (HHA)", 
    "Indicates if Provider can order Power Mobility Devices (PMDs)"
  )) |>
  gt::gt() |> 
  gt::fmt_markdown(columns = Variable) |> 
  gtExtras::gt_theme_nytimes() |> 
  gtExtras::gt_merge_stack(col1 = Description, 
                           col2 = Definition,
                           small_cap = FALSE,
                           font_size = c("16px", "14px"),
                           font_weight = c("bold", "normal"),
                           palette = c("black", "darkgray")) |> 
  gt::opt_stylize(style = 4, color = "gray", add_row_striping = FALSE) |> 
  gt::opt_table_lines(extent = "default") |> 
  gt::opt_table_outline(style = "none")
```

<br>

### Related Links

   - [Medicare Order and Referring API](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/order-and-referring)
   - [CMS.gov: Ordering & Certifying](https://www.cms.gov/medicare/provider-enrollment-and-certification/ordering-and-certifying)
   - [Order and Referring Methodology](https://data.cms.gov/resources/order-and-referring-methodology)

<br><br>
