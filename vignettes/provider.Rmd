---
title: "Overview of Provider"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview of Provider}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

```{r}
library(provider)
```

<br>

## NPPES NPI Registry

```r
nppes_npi(npi = 1043477615)
```

<details><summary>Code</summary>

```{r}
nppes <- nppes_npi(npi = 1043477615)

nppes_1 <- nppes |> 
  dplyr::slice_head() |> 
  dplyr::select(npi:entype, 
                enumeration_duration, 
                first_name:phone_number)

nppes_2 <- nppes_1 |> 
  provider:::gt_prov(source = gt::md("Source: [NPPES NPI Registry](https://npiregistry.cms.hhs.gov/api-page)"), 
                     checkmark = c("sole_proprietor")) |> 
  gt::tab_header(title = paste0("General Information for: ", 
                                nppes_1$first_name, " ", 
                                nppes_1$middle_name, ". ", 
                                nppes_1$last_name, ", ", 
                                nppes_1$credential),
                 subtitle = paste0("Practice Location: ",
                                   nppes_1$street, " ",
                                   nppes_1$city, ", ",
                                   nppes_1$state, " ",
                                   nppes_1$zipcode)) |> 
  gt::cols_hide(columns = c(first_name, 
                            middle_name, 
                            last_name, 
                            credential,
                            gender,
                            street,
                            city,
                            state,
                            zipcode,
                            purpose,
                            country)) |> 
  gt::cols_label(entype = "Type")
```

</details>


```{r, echo=FALSE, eval=TRUE}
nppes_2
```


<br>

<details><summary>Code</summary>

```{r}
nppes_3 <- nppes |> 
  dplyr::slice_head(n = 3) |> 
  dplyr::select(tx_code, tx_primary, tx_desc, tx_state, tx_license) |> 
  provider:::gt_prov(source = gt::md("Source: [NPPES NPI Registry](https://npiregistry.cms.hhs.gov/api-page)"), 
                     checkmark = c("tx_primary")) |> 
  gt::tab_header(title = paste0("Taxonomy Information: ", 
                                nppes_1$first_name, " ", 
                                nppes_1$middle_name, ". ", 
                                nppes_1$last_name, ", ", 
                                nppes_1$credential),
                 subtitle = paste0("Practice Location: ",
                                   nppes_1$street, " ",
                                   nppes_1$city, ", ",
                                   nppes_1$state, " ",
                                   nppes_1$zipcode)) |> 
  gt::cols_label(tx_code = "Taxonomy",
                 tx_desc = "Description",
                 tx_state = "State",
                 tx_license = "License",
                 tx_primary = "Primary")
```


</details>

```{r, echo=FALSE, eval=TRUE}
nppes_3
```


<br>

## Order & Referring Eligibility


```r
order_refer(npi = 1043477615)
```

<details><summary>Code</summary>

```{r}
oar_1 <- order_refer(npi = 1043477615) |> 
  provider:::gt_prov(divider = c("last_name"), 
                     checkmark = c("partb", "dme", "hha", "pmd"),
                     title = "Medicare Order & Referring Eligibility",
                     source = gt::md("Source: [Medicare Order and Referring API](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/order-and-referring)")) |> 
  gt::cols_label(partb = "Part B")
```

</details>

```{r, echo=FALSE, eval=TRUE}
oar_1
```

<br>

## Provider Enrollment

```r
provider_enrollment(npi = 1043477615)
```
<details><summary>Code</summary>

```{r}
pro_en <- provider_enrollment(npi = 1043477615) |> 
  dplyr::select(pac_id, 
                enroll_id, 
                specialty_code, 
                specialty_desc) |> 
  provider:::gt_prov(title = "Medicare Enrollment Information",
    source = gt::md("Source: [Medicare Fee-For-Service Public Provider Enrollment API](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/medicare-fee-for-service-public-provider-enrollment)")) |> 
  gt::cols_label(pac_id = "PAC ID", 
                 enroll_id = "Enrollment ID", 
                 specialty_desc = "Specialty Description")
```

</details>

```{r, echo=FALSE, eval=TRUE}
pro_en
```


<br>

## Doctors and Clinicians

```r
doctors_and_clinicians(npi = 1043477615)
```
<details><summary>Code</summary>

```{r}
dcli <- doctors_and_clinicians(npi = 1043477615)

dcli_1 <- dcli |> 
  dplyr::select(school, 
                grad_year, 
                grad_duration, 
                specialty, 
                ind_assn) |> 
  provider:::gt_prov(divider = c("grad_duration"),
                     qmark = c("ind_assn"),
    source = gt::md("Source: [Doctors and Clinicians National Downloadable File](https://data.cms.gov/provider-data/dataset/mj5m-pzi6)")) |> 
  gt::cols_label(school = "Medical School", 
                 grad_year = "Graduated", 
                 ind_assn = "Accepts Assignment")

dcli_2 <- dcli |> 
  dplyr::select(org_name, 
                org_pac_id, 
                org_members, 
                address, 
                city, 
                state, 
                zipcode, 
                phone, 
                group_assn) |> 
  dplyr::mutate(zipcode = campfin::normal_zip(zipcode),
                phone = campfin::normal_phone(phone),
                state = campfin::expand_state(state)) |> 
  tidyr::unite("location", c(address, city, state, zipcode), sep = " ") |> 
  provider:::gt_prov(qmark = c("group_assn"),
    source = gt::md("Source: [Doctors and Clinicians National Downloadable File](https://data.cms.gov/provider-data/dataset/mj5m-pzi6)")) |> 
  gt::cols_label(org_name = "Organization Name", 
                 org_pac_id = "PAC ID", 
                 org_members = "No. of Members", 
                 group_assn = "Accepts Assignment")
```

</details>

```{r, echo=FALSE, eval=TRUE}
dcli_1
dcli_2
```


<br>

## Facility Affiliations / Hospital Enrollment

```r
facility_affiliations(npi = 1043477615) |> 
  dplyr::pull(facility_ccn) |> 
  furrr::future_map(\(x) hospital_enrollment(facility_ccn = x)) |>
  purrr::list_rbind()
```
<details><summary>Code</summary>

```{r, message=TRUE}
fac_hosp <- facility_affiliations(npi = 1043477615) |> 
  dplyr::pull(facility_ccn) |> 
  furrr::future_map(\(x) hospital_enrollment(facility_ccn = x)) |>
  purrr::list_rbind() |> 
  janitor::remove_empty(which = c("rows", "cols"))

hosp_1 <- fac_hosp |> 
  dplyr::select(
    org_name,
    npi, 
    pac_id_org,
    facility_ccn,
    enroll_id,
    specialty_desc,
    specialty_code,
    multiple_npis) |> 
  provider:::gt_prov(checkmark = c("multiple_npis"),
    source = gt::md("Source: [CMS Hospital Enrollments](https://data.cms.gov/provider-characteristics/hospitals-and-other-facilities/hospital-enrollments)")) |> 
  gt::cols_label(org_name = "Organization Name",
                 pac_id_org = "PAC ID",
                 facility_ccn = "CCN",
                 enroll_id = "Enrollment ID",
                 specialty_code = "Code",
                 specialty_desc = "Specialty",
                 multiple_npis = "Multiple NPIs")

hosp_2 <- fac_hosp |> 
  dplyr::select(
    org_name,
    incorp_date,
    incorp_duration,
    proprietary_nonprofit,
    address,
    city,
    state,
    zipcode) |> 
  dplyr::mutate(zipcode = campfin::normal_zip(zipcode),
                state = campfin::expand_state(state)) |> 
  tidyr::unite("location", c(address, city, state, zipcode), sep = " ") |> 
  provider:::gt_prov(divider = c("org_name"),
                     checkmark = c("proprietary_nonprofit"),
    source = gt::md("Source: [CMS Hospital Enrollments](https://data.cms.gov/provider-characteristics/hospitals-and-other-facilities/hospital-enrollments)")) |> 
  gt::cols_label(org_name = "Organization Name", 
                 incorp_date = "Date Incorporated",
                 incorp_duration = "Years Incorporated",
                 proprietary_nonprofit = "Nonprofit")

hosp_3 <- fac_hosp |> 
  dplyr::select(
    org_name,
    sg_general,
    sg_acute_care,
    sg_alcohol_drug,
    sg_childrens,
    sg_long_term,
    sg_short_term,
    sg_psychiatric,
    sg_psychiatric_unit,
    sg_rehabilitation,
    sg_rehabilitation_unit,
    sg_swing_bed_approved,
    sg_specialty_hospital,
    sg_other) |> 
  provider:::gt_prov(divider = c("org_name"),
                     checkmark = c("sg_general",
                                   "sg_acute_care",
                                   "sg_alcohol_drug",
                                   "sg_childrens",
                                   "sg_long_term",
                                   "sg_short_term",
                                   "sg_psychiatric",
                                   "sg_psychiatric_unit",
                                   "sg_rehabilitation",
                                   "sg_rehabilitation_unit",
                                   "sg_swing_bed_approved",
                                   "sg_specialty_hospital",
                                   "sg_other"),
    source = gt::md("Source: [CMS Hospital Enrollments](https://data.cms.gov/provider-characteristics/hospitals-and-other-facilities/hospital-enrollments)")) |> 
  gt::cols_label(org_name = "Organization Name",
                 sg_general = "General",
                 sg_acute_care = "Acute Care",
                 sg_alcohol_drug = "Alcohol/Drug",
                 sg_childrens = "Childrens",
                 sg_long_term = "Long-Term",
                 sg_short_term = "Short-Term",
                 sg_psychiatric = "Psych",
                 sg_psychiatric_unit = "Psych Unit",
                 sg_rehabilitation = "Rehab",
                 sg_rehabilitation_unit = "Rehab Unit",
                 sg_swing_bed_approved = "Swing Bed",
                 sg_specialty_hospital = "Specialty",
                 sg_other = "Other")
```

</details>

```{r, echo=FALSE, eval=TRUE}
hosp_1
hosp_2
hosp_3
```


<br>

## Revalidation Date / Reassignment

```r
revalidation_date(npi = 1043477615)
revalidation_reassign(npi = 1043477615)
```

<details><summary>Code</summary>

```{r}
re_date <- revalidation_date(npi = 1043477615) |> 
  dplyr::select(enroll_id, 
                enroll_state, 
                enroll_type, 
                enroll_specialty) |> 
  dplyr::mutate(enroll_state = campfin::expand_state(enroll_state)) |> 
  provider:::gt_prov(source = gt::md("Source: [Medicare Revalidation Due Date API](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/revalidation-due-date-list)")) |> 
  gt::cols_label(enroll_id = "Enrollment ID", 
                enroll_state = "Enrollment State", 
                enroll_type = "Enrollment Type", 
                enroll_specialty = "Enrollment Specialty")

re_assign <- revalidation_reassign(npi = 1043477615) |> 
  dplyr::select(business_name, 
                state_group, 
                pac_id_group, 
                enroll_id_group, 
                group_reassign_and_phys_assist) |> 
  dplyr::mutate(state_group = campfin::expand_state(state_group)) |> 
  provider:::gt_prov(source = gt::md("Source: [Medicare Revalidation Reassignment API](https://data.cms.gov/provider-characteristics/medicare-provider-supplier-enrollment/revalidation-reassignment-list)")) |> 
  gt::cols_label(business_name = "Business Name", 
                 state_group = "State", 
                 group_reassign_and_phys_assist = "Reassignments / Physicians Assistants",
                 pac_id_group = "PAC ID", 
                 enroll_id_group = "Enrollment ID")
```

</details>


```{r, echo=FALSE, eval=TRUE}
re_date
re_assign
```

<br>

## Physician & Other Practitioners

```{r}
provider <- 2014:2021 |> 
  furrr::future_map(\(x) physician_by_provider(year = x, npi = 1043477615)) |> 
  purrr::list_rbind()

provider_1 <- provider |> 
  dplyr::select(year, 
                tot_benes, 
                tot_srvcs,
                tot_charges,
                tot_allowed,
                tot_payment) |> 
  provider:::change_abs(tot_benes, year) |> 
  provider:::change_pct(tot_benes, tot_benes_chg, year) |> 
  provider:::change_abs(tot_srvcs, year) |> 
  provider:::change_pct(tot_srvcs, tot_srvcs_chg, year) |> 
  dplyr::select(!c(tot_benes_chg, tot_srvcs_chg)) |> 
  provider:::gt_prov(source = gt::md("Source: [Medicare Physician & Other Practitioners: by Provider
                                     API](https://data.cms.gov/provider-summary-by-type-of-service/medicare-physician-other-practitioners/medicare-physician-other-practitioners-by-provider)"),
                     title = gt::md("Medicare Provider Summary: **2014 - 2021**"),
                     subtitle = gt::md("Provider: **SARAH K. HUSSAIN, MD**"),
                     divider = c("year", "tot_srvcs"),
                     dollars = c("tot_charges", "tot_allowed", "tot_payment"),
                     pctchg = c("tot_benes_pct", "tot_srvcs_pct")) |>
  gt::cols_label(tot_benes = "Beneficiaries", 
                 tot_srvcs = "Services",
                 tot_charges = "Charges",
                 tot_allowed = "Allowed",
                 tot_payment = "Payment") |> 
  gt::cols_merge_n_pct(tot_benes, tot_benes_pct) |> 
  gt::cols_merge_n_pct(tot_srvcs, tot_srvcs_pct) |> 
  gtExtras::gt_color_rows(columns = c("tot_charges", "tot_allowed", "tot_payment"))

provider_2 <- provider |> 
  dplyr::select(year, bene_age_avg)

pr_age <- provider |> 
  dplyr::select(year,
                bene_age_lt65,
                bene_age_65_74,
                bene_age_75_84,
                bene_age_gt84) |> 
  dplyr::mutate(bene_age_65_84 = bene_age_65_74 + bene_age_75_84, 
                .keep = "unused", 
                .after = bene_age_lt65) |> 
  tidyr::pivot_longer(cols = c(bene_age_lt65, bene_age_65_84, bene_age_gt84), 
                      names_to = "measure", 
                      values_to = "demo_age") |> 
  dplyr::group_by(year) |> 
  dplyr::summarise(demo_age = list(demo_age), .groups = "drop")

pr_sex <- provider |> 
  dplyr::select(year,
                bene_female,
                bene_male) |> 
  tidyr::pivot_longer(cols = c(bene_female, bene_male), 
                      names_to = "measure", 
                      values_to = "demo_sex") |> 
  dplyr::group_by(year) |> 
  dplyr::summarise(demo_sex = list(demo_sex), .groups = "drop")


pr_stat <- provider |> 
  dplyr::select(year,
                bene_dual,
                bene_ndual) |> 
  tidyr::pivot_longer(cols = c(bene_dual, bene_ndual), 
                      names_to = "measure", 
                      values_to = "demo_stat") |> 
  dplyr::group_by(year) |> 
  dplyr::summarise(demo_stat = list(demo_stat), .groups = "drop")

provider_2 <- provider_2 |> 
  dplyr::left_join(pr_age, by = c("year")) |> 
  dplyr::left_join(pr_sex, by = c("year")) |> 
  dplyr::left_join(pr_stat, by = c("year")) |> 
  provider:::gt_prov(source = gt::md("Source: [Medicare Physician & Other Practitioners: by Provider
                                     API](https://data.cms.gov/provider-summary-by-type-of-service/medicare-physician-other-practitioners/medicare-physician-other-practitioners-by-provider)"),
                     title = gt::md("Medicare Provider Summary: **2014 - 2021**"),
                     subtitle = gt::md("Provider: **SARAH K. HUSSAIN, MD**"),
                     divider = c("year", "bene_age_avg")) |> 
  gt::cols_label(bene_age_avg = "Avg. Age") |> 
  gtExtras::gt_plt_bar_stack(column = demo_age, 
                             width = 60,
                             labels = c("< 65  ", " 65-84 ", " > 84"),
                             palette = c("grey", "black", "#ff4343")) |> 
  gtExtras::gt_plt_bar_stack(column = demo_sex, 
                             width = 40,
                             labels = c("Female ", " Male"),
                             palette = c("black", "#ff4343")) |> 
  gtExtras::gt_plt_bar_stack(column = demo_stat, 
                             width = 45,
                             labels = c("Dual ", " Non-Dual"),
                             palette = c("black", "#ff4343")) |> 
  gtExtras::gt_color_rows(columns = c("bene_age_avg"))

provider_3 <- provider |> 
  dplyr::select(year,
                #"HCC Average Risk Score" = bene_risk_avg,
                "Atrial Fibrillation" = bene_cc_af,
                "Alzheimerâ€™s / Dementia" = bene_cc_alz,
                "Asthma" = bene_cc_asth,
                "Cancer" = bene_cc_canc,
                "Heart Failure (CHF)" = bene_cc_chf,
                "Chronic Kidney Disease" = bene_cc_ckd,
                "COPD" = bene_cc_copd,
                "Depression" = bene_cc_dep,
                "Diabetes" = bene_cc_diab,
                "Hyperlipidemia" = bene_cc_hplip,
                "Hypertension" = bene_cc_hpten,
                "Ischemic Heart Disease" = bene_cc_ihd,
                "Osteoporosis" = bene_cc_opo,
                "Rheumatoid / Osteoarthritis" = bene_cc_raoa,
                "Schizophrenia / Other Psych" = bene_cc_sz,
                "Stroke" = bene_cc_strk) |> 
  tidyr::pivot_longer(cols = !year, 
                      names_to = "stat", 
                      values_to = "value") |> 
  tidyr::pivot_wider(names_from = year, 
                     values_from = value) |> 
  provider:::gt_prov(source = gt::md("Source: [Medicare Physician & Other Practitioners: by Provider
                                     API](https://data.cms.gov/provider-summary-by-type-of-service/medicare-physician-other-practitioners/medicare-physician-other-practitioners-by-provider)"),
                     title = gt::md("Medicare Provider Summary: **2014 - 2021**"),
                     subtitle = gt::md("Provider: **SARAH K. HUSSAIN, MD**"),
                     divider = c("stat"), 
                     pct = c("2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"),
                     clean = FALSE)
```


```{r}
provider_1
provider_2
provider_3
```



```{r}
service <- 2014:2021 |> 
  furrr::future_map(\(x) physician_by_service(year = x, npi = 1043477615)) |> 
  purrr::list_rbind()

service |> 
  dplyr::select(year, 
                hcpcs_cd,
                place_of_srvc,
                hcpcs_desc,
                tot_benes,
                tot_srvcs,
                avg_charge,
                avg_allowed,
                avg_payment)
```

<br>


```{r echo=FALSE, eval=FALSE, include=FALSE}
# First row of data
mpop_ex_2020_row1 <- mpop_ex_2020 |> dplyr::filter(dplyr::row_number() %in% 1)

# First, last, credentials
mpop_ex_name_cred <- stringr::str_c(
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_first_name, "both"), " ",
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_last_org_name, "both"), ", ",
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_crdntls, "both"))

# NPI
mpop_ex_npi <- stringr::str_c(stringr::str_trim(mpop_ex_2020_row1$rndrng_npi, "both"), "")

# Address
mpop_ex_address <- stringr::str_c(
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_st1, "both"), " ",
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_city, "both"), ", ",
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_state_abrvtn, "both"), " ",
  stringr::str_trim(mpop_ex_2020_row1$rndrng_prvdr_zip5, "both"))



gt_table <- mpop_13_20 |>
  dplyr::select(year,
                hcpcs     = hcpcs_cd,
                benefits  = tot_benes,
                services  = tot_srvcs,
                avg_bill  = avg_sbmtd_chrg,
                avg_allow = avg_mdcr_alowd_amt,
                avg_pay   = avg_mdcr_pymt_amt) |> 
  dplyr::group_by(hcpcs) |> 
  dplyr::summarize(
    ben_sum    = sum(benefits),
    ben_mean   = mean(benefits),
    ben_spark  = list(benefits),
    serv_sum   = sum(services),
    serv_mean  = mean(services),
    serv_spark = list(services),
    char_sum   = sum(avg_bill),
    char_mean  = mean(avg_bill),
    char_spark = list(avg_bill),
    all_sum    = sum(avg_allow),
    all_mean   = mean(avg_allow),
    all_spark  = list(avg_allow),
    pay_sum    = sum(avg_pay),
    pay_mean   = mean(avg_pay),
    pay_spark  = list(avg_pay),
    .groups = "drop") |> 
  dplyr::filter(ben_sum > 22) |> 
  dplyr::arrange(desc(ben_sum))


gt_output <- gt_table |> 
  gt::gt() |> 
  gt::tab_header(
  title = gt::md(paste0(mpop_ex_name_cred, "**Medicare Data Report**: 2013 - 2020.")), 
  subtitle = gt::md(
  "NPI: 1760485387. HCPCS Codes with a beneficiary count *less than 30* have been excluded.")) |> 
  gtExtras::gt_theme_538() |> 
  gt::tab_options(footnotes.multiline = TRUE, 
                  table.font.size = "16px",
                  heading.title.font.size = "22px") |> 
  gtExtras::gt_plt_sparkline(ben_spark, 
                             type = "ref_iqr", 
                             fig_dim = c(5, 30), 
                             same_limit = FALSE, 
                             label = FALSE,
                             palette = c("black", 
                                         "black", 
                                         "blue", 
                                         "green", 
                                         "blue")) |> 
  gtExtras::gt_plt_sparkline(serv_spark, 
                             type = "ref_iqr", 
                             fig_dim = c(5, 30), 
                             same_limit = FALSE, 
                             label = FALSE,
                             palette = c("black", 
                                         "black", 
                                         "blue", 
                                         "green", 
                                         "blue")) |> 
  gtExtras::gt_plt_sparkline(char_spark, 
                             type = "ref_iqr", 
                             fig_dim = c(5, 30), 
                             same_limit = FALSE, 
                             label = FALSE,
                             palette = c("black", 
                                         "black", 
                                         "blue", 
                                         "green", 
                                         "orange")) |> 
  gtExtras::gt_plt_sparkline(all_spark, 
                             type = "ref_iqr", 
                             fig_dim = c(5, 30), 
                             same_limit = FALSE, 
                             label = FALSE,
                             palette = c("black", 
                                         "black", 
                                         "blue", 
                                         "green", 
                                         "orange")) |> 
  gtExtras::gt_plt_sparkline(pay_spark, 
                             type = "ref_iqr", 
                             fig_dim = c(5, 30), 
                             same_limit = FALSE, 
                             label = FALSE,
                             palette = c("black", 
                                         "black", 
                                         "blue", 
                                         "green", 
                                         "orange")) |> 
  gtExtras::gt_add_divider(columns = "hcpcs", 
                           style = "solid", 
                           include_labels = FALSE,
                           weight = gt::px(3),
                           color = "gray") |>
  gt::fmt_number(columns = c(ben_sum:ben_mean, 
                             serv_sum:serv_mean), 
                             decimals = 0) |> 
  gt::fmt_currency(columns = c(char_sum:char_mean, 
                               all_sum:all_mean, 
                               pay_sum:pay_mean), 
                               currency = "USD") |> 
  gt::tab_spanner(label = "Beneficiaries", 
                  id = "ben", 
                  columns = c(ben_sum, 
                              ben_mean, 
                              ben_spark)) |> 
  gt::tab_spanner(label = "Services", 
                  id = "serv", 
                  columns = c(serv_sum, 
                              serv_mean, 
                              serv_spark)) |> 
  gt::tab_spanner(label = "Submitted Charge", 
                  columns = c(char_sum,
                              char_mean, 
                              char_spark)) |> 
  gt::tab_spanner(label = "Allowed Amount", 
                  columns = c(all_sum,
                              all_mean, 
                              all_spark)) |> 
  gt::tab_spanner(label = "Payment", 
                  columns = c(pay_sum,
                              pay_mean, 
                              pay_spark)) |> 
  gt::cols_label(ben_sum = "Count", 
                 ben_mean = "Average", 
                 ben_spark = "Trend") |> 
  gt::cols_label(serv_sum = "Count", 
                 serv_mean = "Average", 
                 serv_spark = "Trend") |> 
  gt::cols_label(char_sum = "Sum",
                 char_mean = "Average", 
                 char_spark = "Trend") |> 
  gt::cols_label(all_sum = "Sum",
                 all_mean = "Average", 
                 all_spark = "Trend") |> 
  gt::cols_label(pay_sum = "Sum", 
                 pay_mean = "Average", 
                 pay_spark = "Trend") |> 
  gt::tab_source_note(
    source_note = gt::md("Data Source: **Medicare** Physician & Other Practitioners by Provider and Service, 2013 - 2020.")) |> 
  gt::tab_footnote(
    footnote = gt::md("Number of *distinct* Medicare beneficiaries receiving the service for each HCPCS code."), 
    locations = gt::cells_column_spanners(spanners = "ben")) |> 
  gt::tab_footnote(
    footnote = gt::md("Number of services provided. *Note: The metrics used to count the number provided can vary from service to service.*"),
    locations = gt::cells_column_spanners(spanners = "serv")) |> 
  gtExtras::gt_color_rows(columns = ben_sum, 
                          palette = "RColorBrewer::Blues", pal_type = "continuous", domain = range(gt_table$ben_sum)) |> 
  gtExtras::gt_color_rows(columns = ben_mean, 
                          palette = "RColorBrewer::Blues", pal_type = "continuous", domain = range(gt_table$ben_mean)) |> 
  gtExtras::gt_color_rows(columns = serv_sum, 
                          palette = "RColorBrewer::Blues", pal_type = "continuous", domain = range(gt_table$serv_sum)) |> 
  gtExtras::gt_color_rows(columns = serv_mean, 
                          palette = "RColorBrewer::Blues", pal_type = "continuous", domain = range(gt_table$serv_mean)) |> 
  gtExtras::gt_color_rows(columns = char_sum, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$char_sum)) |> 
  gtExtras::gt_color_rows(columns = char_mean, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$char_mean)) |> 
  gtExtras::gt_color_rows(columns = all_sum, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$all_sum)) |> 
  gtExtras::gt_color_rows(columns = all_mean, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$all_mean)) |> 
  gtExtras::gt_color_rows(columns = pay_sum, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$pay_sum)) |> 
  gtExtras::gt_color_rows(columns = pay_mean, 
                          palette = "RColorBrewer::Oranges", pal_type = "continuous", domain = range(gt_table$pay_mean)) |> 
  gt::opt_vertical_padding(scale = 1.5)
```

<br>
