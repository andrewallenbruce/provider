---
title: "Overview of Provider"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview of Provider}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
library(printr)
```

```{r}
library(provider)
library(purrr)
library(dplyr)
```


The overarching goal of `provider` is to make the experience of accessing publicly-available Provider data easier and more consistent across a variety of sources. It aims to accomplish this through the following general goals, where possible:


   - **Tidy Output**, with an option to turn it off by setting `tidy = FALSE`.

   - **Variable Standardization**, for the express purpose of making it easier to understand (and make connections between) each API's output. This will also allow for removal of duplicate information across API output, if desired.
   
   - **Input Validation**. Not only is this simply good practice, it also prevents unnecessary querying of APIs.
   
   - **Helpful Documentation**. Each API's output can be difficult to understand, even for someone with expertise in R, healthcare, or both.

<br>

## Tidy Output

In [**tidy data**](https://tidyr.tidyverse.org/articles/tidy-data.html), every **column** is a *variable*, every **row** is an *observation*, and every **cell** is a *single value*. 

Many of the outputs of these APIs violate this form by 

   - Storing column headers as values, not variable names
   - Storing multiple variables in one column

To remedy this, there is some post-processing done to the output before it is returned. Each function has a `tidy` argument that is set to `TRUE` by default:

```{r}
order_refer(npi = 1043477615)
```

<br>

Setting it to `FALSE` will return the un-processed output:

```{r}
order_refer(npi = 1043477615, tidy = FALSE)
```

<br>

The `tidy` transformations applied to the output of each function include: 

   - Favoring a long format over wide.
   - More descriptive, thematic variable names involving prefixes and a standardized vocabulary across all outputs
   - Various quality-of-life data transformations (e.g., using `snake_case` for variable names, replacing empty character cells with `NA`; converting years, dates, booleans to their respective data types)
   - Nesting large groups of related columns into lists, to initially emphasize the most important output.

However, in the event that you would prefer to do your own transformations, simply turn it off with `tidy = FALSE`.

<br>

## Exported Functions

The API Search functions can be grouped according to the type of data that they return about a provider: *administrative*, *statistical*, and *auxiliary.*

### Administrative

   * `nppes()`: Registry of all healthcare providers.
   * `providers()`: Providers actively enrolled in Medicare.
   * `opt_out()`: Providers currently opted out of Medicare.
   * `revalidation()`: Link Type-1 and Type-2 providers.
   * `clinicians()`: Provider school, graduation year, linking.
   * `affiliations()`: Linking providers to Facilities.
   * `hospitals()`: Facilities linked to providers.

### Statistical

The following return provider-specific stats:

   * `by_provider()`: Yearly high-level utilization data.
   * `by_service()`: Yearly detailed utilization data.
   * `quality_payment()`: Yearly QPP/MIPS performance data.
   * `quality_eligibility()`: Yearly QPP/MIPS eligibility data.
   * `open_payments()`: Yearly Open Payments reporting data.

The following return yearly stats useful for comparison against data returned from `by_service()`:

   * `by_geography()`
   * `beneficiaries()`
   * `cc_multiple()`
   * `cc_specific()`

### Auxiliary

   * `order_refer()`: Is a provider eligible to order and refer?
   * `pending()`: Has a provider's Medicare application been processed?
   * `taxonomy()`: Is a provider's specialty eligible to enroll in Medicare?
   * `quality_stats()`: Yearly QPP/MIPS performance data.

<br>

## Helper Functions

Several functions have a required `year` argument. The years available to query these APIs might change at any time, so there is an accompanying helper function to retrieve the years available, in the form of `<function_name>_years()`. For instance, `quality_payment()`'s is:

```{r}
quality_payment_years()
```

These can also be used in a pipeline, for searching all available years:

```{r}
quality_payment_years() |> 
  map(\(x) quality_payment(year = x, npi = 1043477615)) |> 
  list_rbind() |> 
  select(year:final_score)
```

<br>

## Validation Checks

Several validation checks have been implemented, including checks for *NPIs*, *PAC IDs*, and *Enrollment IDs*:

> **National Provider Identifier**: 
> A National Provider Identifier (NPI) is a unique 10-digit identification number issued to health care providers in the United States by the Centers for Medicare and Medicaid Services (CMS) through the National Plan and Provider Enumeration System (NPPES). All individual HIPAA–covered healthcare providers or organizations must obtain an NPI. Once assigned, a provider’s NPI is permanent and remains with the provider regardless of job or location changes.

```{r}
# Must be 10 digits long
open_payments(npi = 12345691234)

# Must be numeric
nppes(npi = "O12345678912")

# Must pass Luhn check
pending(npi = 001234569123, type = "physician")
```

<br>

> **Provider Associate-level Control ID**:
> A Provider associate-level control ID (PAC ID) is a 10-digit unique numeric identifier that is assigned to each individual or organization in PECOS. The PAC ID links all entity-level information (e.g., tax identification numbers and organizational names) and may be associated with multiple enrollment IDs if the individual or organization enrolled multiple times under different circumstances.


```{r}
# Must be 10 digits long
affiliations(pac_id_ind = 0123456789)

# Must be numeric
hospitals(pac_id_org = "O12345678912")
```

<br>

> **Medicare Enrollment ID**:
> An Enrollment ID is a 15-digit unique alphanumeric identifier that is assigned to each new provider enrollment application. All enrollment-level information (e.g., enrollment type, enrollment state, provider specialty and reassignment of benefits) is linked through the Enrollment ID.

```{r}
# Must be a character vector
clinicians(enroll_id_ind = 0123456789123456)

# Must be 15 characters long
revalidation_date(enroll_id = "I123456789123456")

# Must begin with a capital I (Individual) or O (Organization/Group)
providers(enroll_id = "012345678912345")

# Some functions require one of ID types
hospitals(enroll_id_org = "I20180115000174")
```

<br>

> Numeric Parameters with Leading Zeros
R will drop any leading zeros in a numeric vector. For any parameters that may contain leading zeros, make sure that they're input as a character vector. :

```{r}
0001

"0001"
```





