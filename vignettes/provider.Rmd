---
title: "Overview of Provider"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview of Provider}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

```{r}
library(provider)
```

<br>

The overarching goal of `provider` is to make the experience of accessing publicly-available Provider data easier and more consistent across a variety of sources. It aims to accomplish this through the following general goals, where possible:

<br>

   * *Structuring output in the **tidy** framework* as much as is reasonably possible, with an option to turn it off by setting `tidy = FALSE`.

   * *Harmonization of variable names*, for the express purpose of making it easier to understand (and make connections between) each API's output. This will also allow for removal of duplicate information across API output, if desired.
   
   * *Validation checks of inputs*, as is reasonable (e.g, identifiers such as NPI, PAC ID, Medicare Enrollment ID, CCN, Taxonomy codes). Not only is this simply good practice, it will also prevent unnecessary querying of the APIs.
   
   * *Well-written documentation*, containing as many examples as is necessary. Each API's output can be difficult to understand, even for someone with expertise in R, healthcare, or both.

<br>

## Tidy Output

Each function has a `tidy` argument, set to `TRUE` by default:

<br>

```{r}
order_refer(npi = 1043477615) |> 
  dplyr::select(npi, 
                first_name, 
                last_name, 
                "Medicare Part B" = partb,
                "Home Health Agency (HHA)" = hha,
                "Durable Medical Equipment (DME)" = dme,
                "Power Mobility Device (PMD)" = pmd) |> 
  tidyr::pivot_longer(cols = !c(npi, 
                                dplyr::contains("name")), 
                      names_to = "service", 
                      values_to = "eligible")
```

<br>

Setting it to `FALSE` will return the original output:

<br>

```{r}
order_refer(npi = 1043477615, tidy = FALSE)
```

<br>

The `tidy` transformations applied to the output of each function include: 

   * Favoring a long format over wide
   * `snake_case` for variable names
   * More descriptive, thematic variable names involving prefixes and a standardized vocabulary across all outputs
   * Various other quality-of-life data wrangling operations (e.g., replacing empty cells with `NA`, converting year columns to integers, date columns to date type, NPIs to character type)

<br>

However, in the event that you would prefer to do your own transformations, simply turn it off with `tidy = FALSE`.

<br>

## Available Years Helpers

Several functions have a required `year` argument. The years available to query might change at any time, so there's an accompanying helper function to retrieve the years available from each API:

<br>

```{r}
# Quality Payment Program
quality_payment_years()

# Open Payments Program
open_payments_years()

# Physician and Practitioners
physician_by_provider_years()
physician_by_service_years()
physician_by_geography_years()

# Chronic Conditions
cc_specific_years()
cc_multiple_years()
```

<br>

They can also be used in a pipeline:

<br>

```{r}
quality_payment_years() |> 
  furrr::future_map(\(x) quality_payment(year = x, npi = 1043477615)) |> 
  purrr::list_rbind()
```

<br><br>

## APIs

API Search functions can be grouped according to the type of data they return about a provider: *administrative*, *statistical*, and *auxillary.*

### Administrative

   * `nppes_npi()`: Registry of all healthcare providers.
   * `provider_enrollment()`: Providers actively enrolled in Medicare.
   * `opt_out()`: Providers currently opted out of Medicare.
   * `revalidation_*()`: Link Type-1 and Type-2 providers.
   * `doctors_and_clinicians()`: Provider school, graduation year, linking.
   * `facility_affiliations()`: Linking providers to Facilities.
   * `hospital_enrollment()`: Facilities linked to providers.

### Statistical

The following return provider-specific stats:

   * `physician_by_provider()`: Yearly high-level utilization data.
   * `physician_by_service()`: Yearly detailed utilization data.
   * `quality_payments()`: Yearly QPP/MIPS performance data.
   * `quality_eligibility()`: Yearly QPP/MIPS eligibility data.
   * `open_payments()`: Yearly Open Payments reporting data.

The following return yearly stats useful for comparison against data returned from `physician_by_service()`:

   * `physician_by_geography()`
   * `beneficiary_enrollment()`
   * `cc_multiple()`
   * `cc_specific()`

### Auxillary

   * `order_refer()`: Is a provider eligible to order and refer?
   * `missing_information()`: Is a provider missing Endpoints in the NPPES NPI Registry?
   * `pending_applications()`: Has a provider's Medicare application been processed?
   * `taxonomy_crosswalk()`: Is a provider's specialty eligible to enroll in Medicare?

<br>

