---
title: "Overview of Provider"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview of Provider}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

```{r}
library(provider)
library(purrr)
```


The overarching goal of `provider` is to make the experience of accessing publicly-available Provider data easier and more consistent across a variety of sources. It aims to accomplish this through the following general goals, where possible:


   - **Tidy Output**, with an option to turn it off by setting `tidy = FALSE`.

   - **Variable Standardization**, for the express purpose of making it easier to understand (and make connections between) each API's output. This will also allow for removal of duplicate information across API output, if desired.
   
   - **Input Validation**. Not only is this simply good practice, it also prevents unnecessary querying of APIs.
   
   - **Helpful Documentation**. Each API's output can be difficult to understand, even for someone with expertise in R, healthcare, or both.

<br>

## Tidy Output

In [**tidy data**](https://tidyr.tidyverse.org/articles/tidy-data.html), every column is a variable, every row is an observation, and every cell is a single value. Many of the outputs of these APIs violate this form by storing column headers as values, not variable names.

Each function has a `tidy` argument that is set to `TRUE` by default:

```{r}
order_refer(npi = 1043477615)
```

<br>

Setting it to `FALSE` will return the un-tidied output:

```{r}
order_refer(npi = 1043477615, tidy = FALSE)
```

<br>

The `tidy` transformations applied to the output of each function include: 

   - Favoring a long format over wide
   - `snake_case` for variable names
   - More descriptive, thematic variable names involving prefixes and a standardized vocabulary across all outputs
   - Various quality-of-life data wrangling (e.g., replacing empty cells with `NA`, converting year columns to integers, date columns to date type, NPIs to character type)

However, in the event that you would prefer to do your own transformations, simply turn it off with `tidy = FALSE`.

<br>

## Available Years

Several functions have a required `year` argument. The years available to query these APIs might change at any time, so there is an accompanying helper function to retrieve the years available, in the form of `<function_name>_years()`. For instance, `quality_payment()`'s is:

```{r}
quality_payment_years()
```

These can also be used in a pipeline, for searching all available years:

```{r}
quality_payment_years() |> 
  map(\(x) quality_payment(year = x, npi = 1043477615)) |> 
  list_rbind()
```

<br>

## Validation Checks

NPI:

```{r}
# Must be 10 characters long
open_payments(npi = 12345691234)

# Must be numeric
nppes_npi(npi = "O12345678912")

# Must pass Luhn check
pending_applications(npi = 1234569123)
```

<br>

PAC ID

```{r}
# Must be 10 characters long
facility_affiliations(pac_id = 0123456789)

# Must be numeric
hospital_enrollment(pac_id_org = "O12345678912")
```

<br>

Enrollment IDs

```{r}
# Must be a character vector
doctors_and_clinicians(enroll_id = 0123456789123456)

# Must be 15 characters long
revalidation_group(enroll_id = "I123456789123456")

# Must begin with a capital I (Individual) or O (Organization/Group)
provider_enrollment(enroll_id = "012345678912345")
```


## Functions

The API Search functions can be grouped according to the type of data that they return about a provider: *administrative*, *statistical*, and *auxiliary.*

### Administrative

   * `nppes_npi()`: Registry of all healthcare providers.
   * `provider_enrollment()`: Providers actively enrolled in Medicare.
   * `opt_out()`: Providers currently opted out of Medicare.
   * `revalidation_*()`: Link Type-1 and Type-2 providers.
   * `doctors_and_clinicians()`: Provider school, graduation year, linking.
   * `facility_affiliations()`: Linking providers to Facilities.
   * `hospital_enrollment()`: Facilities linked to providers.

### Statistical

The following return provider-specific stats:

   * `physician_by_provider()`: Yearly high-level utilization data.
   * `physician_by_service()`: Yearly detailed utilization data.
   * `quality_payment()`: Yearly QPP/MIPS performance data.
   * `quality_eligibility()`: Yearly QPP/MIPS eligibility data.
   * `open_payments()`: Yearly Open Payments reporting data.

The following return yearly stats useful for comparison against data returned from `physician_by_service()`:

   * `physician_by_geography()`
   * `beneficiary_enrollment()`
   * `cc_multiple()`
   * `cc_specific()`

### Auxiliary

   * `order_refer()`: Is a provider eligible to order and refer?
   * `missing_information()`: Is a provider missing Endpoints in the NPPES NPI Registry?
   * `pending_applications()`: Has a provider's Medicare application been processed?
   * `taxonomy_crosswalk()`: Is a provider's specialty eligible to enroll in Medicare?
   * `quality_stats()`: Yearly QPP/MIPS performance data.

<br>


