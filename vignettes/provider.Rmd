---
title: "Overview of Provider"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overview of Provider}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

```{r}
library(provider)
library(purrr)
library(dplyr)
```


The overarching goal of `{provider}` is to make the experience of accessing publicly-available Provider data easier and more consistent across a variety of sources. It aims to accomplish this through the following goals:


   + Non-Destructive **Tidy Output**, with an option to turn it off by setting a function's `tidy` parameter to `FALSE`.

   + **Variable Standardization**, for the express purpose of making it easier to understand (and make connections between) each API's output. This will also allow for the removal of duplicate information and greatly simplify the process of merging data across outputs.
   
   + **Input Validation**. Not only is this simply good practice, it also prevents unnecessary querying of APIs.
   
   + **Helpful Documentation**. The impetus for this package was to cobble together a motivating example of using a programming language to streamline the process of data acquisition for, among other things, medical coding, billing, and healthcare revenue cycle management. Though it's now grown beyond that, the intended audience remiains the same: non-programmers in healthcare who are interested in what a programming language like R can do to make their work easier. As such, the documentation is written with in a way that assumes no prior knowledge of R or programming in general. Domain-specific terminology and concepts are explained in detail, as there is not one person in existence that understands every aspect of the business of health care, including the author of this package.

<br>

## Tidy Output

In [**tidy data**](https://tidyr.tidyverse.org/articles/tidy-data.html), every **column** is a *variable*, every **row** is an *observation*, and every **cell** is a *single value*. 

Many of the outputs of these APIs violate this form by 

   - Storing column headers as values, not variable names
   - Storing multiple variables in one column

To remedy this, there is some post-processing done to the output before it is returned. Each function has a `tidy` parameter that is set to `TRUE` by default:

```{r}
order_refer(npi = 1043477615)
```

<br>

Setting `tidy` to `FALSE` will return a data.frame of the API's un-processed output:

```{r}
order_refer(npi = 1043477615, tidy = FALSE)
```

<br>

Several functions also have arguments that implement additional optional transformations to the output, such as `pivot`:

```{r}
order_refer(npi = 1043477615, pivot = FALSE)
```

<br>

The `tidy` transformations applied to the output of each function include: 

   - Favoring a long format over wide.
   - More descriptive, thematic variable names involving prefixes and a standardized vocabulary across all outputs
   - Various quality-of-life data transformations (e.g., using `snake_case` for variable names, replacing empty character cells with `NA`; converting years, dates, booleans to their respective data types)
   - Nesting large groups of related columns into lists, to initially emphasize the most important output.

However, in the event that you would prefer to do your own transformations, simply turn it off with `tidy = FALSE`.

<br>

## Exported Functions

The API Search functions can be grouped according to the type of data that they return about a Provider: *administrative*, *statistical*, and *auxiliary.*

   * `nppes()`: Registry of all healthcare providers.
   * `providers()`: Providers actively enrolled in Medicare.
   * `opt_out()`: Providers currently opted out of Medicare.
   * `reassignments()`: Link Type-1 and Type-2 providers.
   * `clinicians()`: Provider school, graduation year, linking.
   * `affiliations()`: Linking providers to Facilities.
   * `hospitals()`: Facilities linked to providers.
   * `laboratories()`: Clinical laboratories.
   * `utilization()`: Utilization summary.
   * `quality_payment()`: QPP/MIPS performance.
   * `open_payments()`: Open Payments reporting.
   * `beneficiaries()`: Medicare enrollment.
   * `conditions`: Chronic condition prevalence.
   * `order_refer()`: Is a provider eligible to order and refer?
   * `pending()`: Has a provider's Medicare application been processed?
   * `taxonomy_crosswalk()`: Is a provider's specialty eligible to enroll in Medicare?
   * `taxonomy_codes()`:

<br>

## Helper Functions

Several functions have a required `year` argument. The years available to query these APIs might change at any time, so there is an accompanying helper function to retrieve the years available, in the form of `<function_name>_years()`. For instance, `quality_payment()`'s is:

```{r}
qpp_years()
```

These can also be used in a pipeline, for searching all available years:

```{r}
map_dfr(qpp_years(), ~quality_payment(year = .x, npi = 1043477615)) |> 
  select(year, size:pay_adjust)
```

<br>

## Validation Checks

Several validation checks have been implemented, including checks for *NPIs*, *PAC IDs*, and *Enrollment IDs*:

> **National Provider Identifier**: 
> A National Provider Identifier (NPI) is a unique 10-digit identification number issued to health care providers in the United States by the Centers for Medicare and Medicaid Services (CMS) through the National Plan and Provider Enumeration System (NPPES). All individual HIPAA–covered healthcare providers or organizations must obtain an NPI. Once assigned, a provider’s NPI is permanent and remains with the provider regardless of job or location changes.

```{r}
# Must be 10 digits long
open_payments(year = 2021, npi = 12345691234)

# Must be numeric
nppes(npi = "O12345678912")

# Must pass Luhn check
pending(type = "P", npi = 001234569123)
```

<br>

> **Provider Associate-level Control ID**:
> A Provider associate-level control ID (PAC ID) is a 10-digit unique numeric identifier that is assigned to each individual or organization in PECOS. The PAC ID links all entity-level information (e.g., tax identification numbers and organizational names) and may be associated with multiple enrollment IDs if the individual or organization enrolled multiple times under different circumstances.


```{r}
# Must be 10 digits long
affiliations(pac = 0123456789)

# Must be numeric
hospitals(pac_org = "O12345678912")
```

<br>

> **Medicare Enrollment ID**:
> An Enrollment ID is a 15-digit unique alphanumeric identifier that is assigned to each new provider enrollment application. All enrollment-level information (e.g., enrollment type, enrollment state, provider specialty and reassignment of benefits) is linked through the Enrollment ID.

```{r}
# Must be a character vector
clinicians(enid = 0123456789123456)

# Must be 15 characters long
reassignments(enid = "I123456789123456")

# Must begin with a capital I (Individual) or O (Organization/Group)
providers(enid = "L12345678912345")

# Some functions require one of ID types
hospitals(enid_org = "I20180115000174")
```

<br>

> **Note**: _R will drop any leading zeros in a numeric vector when it's evaluated._ Parameters that contain leading zeros must be input as a character vector:

<br>

```{r}
# Leading zeros are dropped in an integer vector:
0001
# But preserved in a character vector:
"0001"
```


--------------

